<!DOCTYPE html>
<html lang="en">
	<head>

		<title>Editor (alpha 0.1.7.1)</title>

		<meta charset="utf-8">
		<meta name="generator" content="Three.js Editor">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<link rel="stylesheet" href="/css/joystick.css">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootbox-dialoges.css">
		<link rel="stylesheet" href="/css/jcrop.css">

		<script src="/js/watch.js"></script>
		<script src="/js/Objectid.js"></script>
		<script src="/js/jquery.min.js"></script> 
		<script src="/js/system.min.js"></script>
		<script src="/js/signals.min.js"></script>
		<script src="/js/inflate.min.js"></script>
		<script src="/js/zangodb.min.js"></script>
		<script src="/js/bootstrap.min.js"></script>
		<script src="/js/validator.min.js"></script>
		<script src="/js/hold-event.min.js"></script>
		<script src="/js/jcrop.js"></script>

		<style>

			body {
				margin: 0px;
				font-size: 13px;
				font-family: sans-serif;
				background-repeat: repeat;
				background-image: url("https://i.imgur.com/rnZZU0i.png") !important;
				overflow: hidden;
			}

			#loading-bar {
				width:100%;
				height:100%;
				top:0; left:0;
				position:fixed;
				display:flex;
				align-items:center;
				justify-content:center;
			}

			.middle > * {
				top:0; 
				left:0;
				right:0;
				bottom:0;
				margin:auto;
				position:absolute;
			}

			#joystick1 {
				right: calc(40px + 370px);
			}
			
			#jumpButton {
				right: calc(105px + 370px);
			}

			.btn-matcap,
			.btn-terrain {
				padding:0;
				float:left;
				width:55px;
				height:55px;
				border:1px solid;
				border-radius:4px;
				margin-right:4px;
				margin-bottom:4px;
				display:inline-block;
			}

			.btn-matcap + .btn-matcap,
			.btn-terrain + .btn-terrain {
				margin-right:4px;
			}

		</style>
	</head>

	<body ontouchstart="">

		<script src="/editor/js/TabUI.js"></script>

		<script>
			const debugMode = true;
			const Signal = signals.Signal;
			const RAD2DEG = 57.29577951308232;
			const DEG2RAD = 0.017453292519943295;
			document.body.appendChild( createSidePanel() );
		</script>

		<script src="/editor/js/three.js"></script>
		<script src="/editor/js/MeshWalk.js"></script>
		<script src="/editor/js/UVsDebug.js"></script>
		<script src="/editor/js/FBXLoader.js"></script>
		<script src="/editor/js/VirtualInput.js"></script>
		<script src="/editor/js/KeyboardState.js"></script>
		<script src="/editor/js/EditorControls.js"></script>
		<script src="/editor/js/camera-controls.js"></script>
		<script src="/editor/js/SubdivisionModifier.js"></script>
		<script src="/editor/js/three-pathfinding.umd.js"></script>

		<script src="/threejs/r96/examples/js/loaders/MTLLoader.js"></script>
		<script src="/threejs/r96/examples/js/loaders/OBJLoader.js"></script>
		<script src="/threejs/r96/examples/js/loaders/GLTFLoader.js"></script>

		<script src="/threejs/r96/examples/js/exporters/GLTFExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/STLExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/OBJExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/ColladaExporter.js"></script>

	<!-- Water.js -->

		<script src="/editor/js/Ocean_fft.js"></script>
		<script src="/editor/js/MirrorRenderer.js"></script>
		<script src="/editor/js/WaterMaterial.js"></script>

	<!-- Engine.js -->

		<script src="/editor/core/helpers.js"></script>
		<script src="/editor/core/keyboard.js"></script>
		<script src="/editor/core/enviroment.js"></script>
		<script src="/editor/core/localPlayer.js"></script>
		<script src="/editor/core/cameraControls.js"></script>
		<script src="/editor/core/keyboardState.js"></script>
		<script src="/editor/core/keyInputControls.js"></script>
		<script src="/editor/core/joystickControls.js"></script>

	<!-- Editor.js -->

		<script src="/editor/src/EntityManager.js"></script>
		<script src="/editor/src/MaterialManager.js"></script>
		<script src="/editor/src/TexturesManager.js"></script>
		<script src="/editor/src/UndoArray.js"></script>
		<script src="/editor/src/imgru-db.js"></script>
		<script src="/editor/src/editor-meta.js"></script>
		<script src="/editor/src/material-db.js"></script>

		<script src="/editor/src/editor-tab-ui.js"></script>
		<script src="/editor/src/geometry-tab-ui.js"></script>
		<script src="/editor/src/material-tab-ui.js"></script>
		<script src="/editor/src/material-editor-textures-tab-ui.js"></script>
		<script src="/editor/src/images-tab-ui.js"></script>
		<script src="/editor/src/model3D-tab-ui.js"></script>
		<script src="/editor/src/skydome-tab-ui.js"></script>
		<script src="/editor/src/textures-tab-ui.js"></script>

		<script src="/editor/src/watchers-call-ui.js"></script>
		<script src="/editor/src/entities-helpers.js"></script>
		<script src="/editor/src/TextureEditor.js"></script>
		<script src="/editor/src/MaterialEditor.js"></script>
		<script src="/editor/src/Object3DEditor.js"></script>
		<script src="/editor/src/RigidObjects.js"></script>
		<script src="/editor/src/editor-droplists.js"></script>
		<script src="/editor/src/edges-helper.js"></script>
		<script src="/editor/src/octree-helpers.js"></script>
		<script src="/editor/src/geometry-buttons.js"></script>
		<script src="/editor/src/geometry-inputs.js"></script>
		<script src="/editor/src/editor-buttons.js"></script>
		<script src="/editor/src/rigid-objects-buttons.js"></script>
		<script src="/editor/src/editor-key-inputs.js"></script>
		<script src="/editor/src/editor-mouse-inputs.js"></script>
		<script src="/editor/src/editor-manager.js"></script>
		<script src="/editor/src/editor-systems.js"></script>
		<script src="/editor/src/material-droplists.js"></script>
		<script src="/editor/src/material-manager.js"></script>
		<script src="/editor/src/material-buttons.js"></script>
		<script src="/editor/src/material-key-inputs.js"></script>
		<script src="/editor/src/material-mouse-inputs.js"></script>
		<script src="/editor/src/texture-droplists.js"></script>
		<script src="/editor/src/texture-manager.js"></script>
		<script src="/editor/src/texture-buttons.js"></script>
		<script src="/editor/src/texture-key-inputs.js"></script>
		<script src="/editor/src/texture-mouse-inputs.js"></script>
		<script src="/editor/src/texture-viewer.js"></script>
		<script src="/editor/src/editor-center-helper.js"></script>
		<script src="/editor/src/Water.js"></script>
		<script src="/editor/src/Skydome.js"></script>
		<script src="/editor/src/skydome-droplist.js"></script>
		<script src="/editor/src/background-droplist.js"></script>
		<script src="/editor/src/skydome-buttons.js"></script>
		<script src="/editor/src/images-inputs.js"></script>
		<script src="/editor/src/images-uploads.js"></script>

		<script src="/editor/src/create-new-material-tab-ui.js"></script>
		<script src="/editor/src/create-new-material-viewer.js"></script>
		<script src="/editor/src/create-new-material-buttons.js"></script>

		<script src="/editor/src/material-library-tab-ui.js"></script>
		<script src="/editor/src/material-library-upload-button.js"></script>
		<script src="/editor/src/material-library-update-button.js"></script>
		<script src="/editor/src/material-library-inputs.js"></script>

		<script src="/editor/src/MaterialEditorViewer.js"></script>
		<script src="/editor/src/material-editor-textures-buttons.js"></script>
		<script src="/editor/src/material-editor-textures-key-inputs.js"></script>
		<script src="/editor/src/material-editor-textures-mouse-inputs.js"></script>
		<script src="/editor/src/material-editor-textures-droplists.js"></script>

		<script>

		//	create-matcap-tab-ui.js

			TabUI.add( "NewMatcap", "create-matcap-tab" ); 
			TabUI.append( "NewMatcap" ); TabUI.NewMatcap.pill.innerHTML = "New&nbsp;Matcap";

			(function( tab ){

			//	Create Matcap Collection droplist.
				var row = document.createElement("h3"); row.textContent = "Collection:"; row.style.cssText = "height:30px;";
				var select = document.createElement("select"); select.id = "create-matcap-collection-droplist";
				select.style.cssText = "width:150px;color:#000;float:right;border:1px solid;border-radius:4px;";
				select.style.cssText += "font-size:20px;margin-left:10px;margin-right:15px;padding:2px 4px 4px 4px;";

				var keys = "matcap,environment,others"; // debug!

				keys.split(",").forEach(function( name ){
					var option = document.createElement("option"); option.text = name; option.value = name; select.appendChild( option );
				}); watch( select, "onchange", function(prop, event, value){ console.log({item:select,event:event,value:value}); });
				select.addEventListener( "change", function(){ this.blur(); callWatchers( this, "onchange", "change", this.value ); });

				row.appendChild( select ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-viewer-ui.js

			(function( tab ){

			//	Create Matcap viewer.
				var row = document.createElement("h3"); row.style.cssText = "height:260px;border:none;text-align:center;margin-right:15px;";
				var canvas = document.createElement("canvas"); canvas.width = 256; canvas.height = 256; canvas.id = "create-matcap-viewer"; 
				canvas.style.cssText = "width:256px;height:256px;margin:auto;background-repeat:repeat;background-image:url('https://i.imgur.com/rnZZU0i.png') !important;";
				row.appendChild( canvas ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-name-input-ui.js

			(function( tab ){

			//	Create Matcap Name input.
				var row = document.createElement("h3"); row.style.cssText = "margin-right:15px;height:30px;";
				var input = document.createElement("input"); input.id = "create-matcap-name-input";
				input.setAttribute("placeholder", "name" ); input.classList.add("form-control","text-center");
				input.style.cssText = "width:-webkit-fill-available;color:#000;display:inline;margin:0px 5px;";
				input.style.cssText += "text-align:center;font-size:large;font-weigth:bold;background:none;";
				row.appendChild(input); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-button-ui.js

			(function( tab ){

			//	Create Matcap button.
				var row = document.createElement("h3"); row.style.cssText = "height:40px;margin-bottom:20px;";
				var btn = document.createElement("div"); btn.id = "create-matcap-button"; btn.textContent = "New Matcap";
				btn.classList.add( "form-control","btn", "btn-primary","btn-white-outline","gradient-btn" );
				btn.style.cssText = "width:-webkit-fill-available;height:40px;font-size:large;margin-right:15px;float:right;";
				row.appendChild( btn ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-map-droplist-ui.js

			(function( tab ){

			//	Create Matcap Texture droplist.
				var row = document.createElement("h3"); row.textContent = "select:"; row.style.cssText = "height:30px;";
				var select = document.createElement("select"); select.id = "create-matcap-map-droplist";
				select.style.cssText  = "width:170px;color:#000;float:right;border:1px solid;border-radius:4px;";
				select.style.cssText += "font-size:20px;margin-left:0px;margin-right:15px;padding:2px 4px 4px 4px;";

				var keys =  [
					{name:"Diffuse",value:"map"},
					{name:"Bump",value:"bumpMap"},
					{name:"Alpha",value:"alphaMap"},
					{name:"Light",value:"lightMap"},
					{name:"Normal",value:"normalMap"},
					{name:"Emissive",value:"emissiveMap"},
					{name:"Metalness",value:"metalnessMap"},
					{name:"Roughness",value:"roughnessMap"},
					{name:"Environment",value:"envMap"},
					{name:"Displacement",value:"displacementMap"},
					{name:"Ambient/Occlusion",value:"aoMap"},
				//	{name:"Specular",value:"specularMap"},
				];

				keys.forEach(function( key ){
					var option = document.createElement("option"); option.text = key.name; option.value = key.value; select.appendChild( option );
				}); select.value = "";
				watch( select, "onchange", function(prop, event, value){ console.log({item:select,event:event,value:value}); });
				select.addEventListener( "change", function(){ this.blur(); callWatchers( this, "onchange", "change", this.value ); });

				row.appendChild( select ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-image-button-ui.js

			(function( tab ){

			//	Create Matcap Image button.
				var row = document.createElement("h3"); row.style.cssText = "height:40px;margin-bottom:20px;margin-right:15px;";

				var icon = document.createElement("canvas"); icon.id = "create-matcap-icon";
				icon.width = icon.height = 36; icon.style.cssText = "border:thin solid #888888;border-radius:4px;float:left;";

				var btn = document.createElement("div"); btn.id = "create-matcap-img-button"; 
				btn.classList.add( "form-control","btn", "btn-primary","btn-white-outline","gradient-btn" );
				btn.textContent = "Import Image"; btn.style.cssText = "width:220px;float:right;height:40px;font-size:large;";

				var input = document.createElement("input"); input.type = "file"; 
				input.id = "create-matcap-file-input"; input.style.cssText = "display:none;"; 
				btn.appendChild( input ); row.appendChild( icon ); row.appendChild( btn ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-bump-scale-ui.js

			(function( tab ){

			//	Create Matcap Bump Scale input.
				var row = document.createElement("h3");row.textContent = "bump:"; row.style.cssText = "height:30px;margin:20px 15px 20px 0;";
				var vect = document.createElement("div"); vect.style.cssText = "width:170px;height:40px;float:right;";
				var prev = document.createElement("li"); prev.innerHTML = "&#9668;"; prev.style.display = "inline";
				var next = document.createElement("li"); next.innerHTML = "&#9658;"; next.style.display = "inline";
				prev.id = "create-matcap-bump-decrease"; prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");
				next.id = "create-matcap-bump-increase"; next.classList.add("btn","btn-primary","get-next-btn","pull-right"); 

				var input = document.createElement("input"); input.id = "create-matcap-bump-input";
				input.setAttribute("placeholder", "scale" ); input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";
				vect.appendChild(prev); vect.appendChild(input); vect.appendChild(next); row.appendChild(vect); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-normal-scale-ui.js

			(function( tab ){

			//	Create Matcap Normal Scale input.
				var row = document.createElement("h3");row.textContent = "normal:"; row.style.cssText = "height:30px;margin:20px 15px 20px 0;";
				var vect = document.createElement("div"); vect.style.cssText = "width:170px;height:40px;float:right;";
				var prev = document.createElement("li"); prev.innerHTML = "&#9668;"; prev.style.display = "inline";
				var next = document.createElement("li"); next.innerHTML = "&#9658;"; next.style.display = "inline";
				prev.id = "create-matcap-normal-decrease"; prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");
				next.id = "create-matcap-normal-increase"; next.classList.add("btn","btn-primary","get-next-btn","pull-right"); 

				var input = document.createElement("input"); input.id = "create-matcap-normal-input";
				input.setAttribute("placeholder", "scale" ); input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";
				vect.appendChild(prev); vect.appendChild(input); vect.appendChild(next); row.appendChild(vect); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-displacement-scale-ui.js

			(function( tab ){

			//	Create Matcap Displacement Scale input.
				var row = document.createElement("h3");row.textContent = "displac:"; row.style.cssText = "height:30px;margin:20px 15px 20px 0;display:none;";
				var vect = document.createElement("div"); vect.style.cssText = "width:170px;height:40px;float:right;";
				var prev = document.createElement("li"); prev.innerHTML = "&#9668;"; prev.style.display = "inline";
				var next = document.createElement("li"); next.innerHTML = "&#9658;"; next.style.display = "inline";
				prev.id = "create-matcap-displace-decrease"; prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");
				next.id = "create-matcap-displace-increase"; next.classList.add("btn","btn-primary","get-next-btn","pull-right"); 

				var input = document.createElement("input"); input.id = "create-matcap-displace-input";
				input.setAttribute("placeholder", "scale" ); input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";
				vect.appendChild(prev); vect.appendChild(input); vect.appendChild(next); row.appendChild(vect); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-roughness-ui.js

			(function( tab ){

			//	Create Matcap Roughness input.
				var row = document.createElement("h3");row.textContent = "rough:"; row.style.cssText = "height:30px;margin:20px 15px 20px 0;";
				var vect = document.createElement("div"); vect.style.cssText = "width:170px;height:40px;float:right;";
				var prev = document.createElement("li"); prev.innerHTML = "&#9668;"; prev.style.display = "inline";
				var next = document.createElement("li"); next.innerHTML = "&#9658;"; next.style.display = "inline";
				prev.id = "create-matcap-roughness-decrease"; prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");
				next.id = "create-matcap-roughness-increase"; next.classList.add("btn","btn-primary","get-next-btn","pull-right"); 

				var input = document.createElement("input"); input.id = "create-matcap-roughness-input";
				input.setAttribute("placeholder", "num" ); input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";
				vect.appendChild(prev); vect.appendChild(input); vect.appendChild(next); row.appendChild(vect); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-metalness-ui.js

			(function( tab ){

			//	Create Matcap Roughness input.
				var row = document.createElement("h3");row.textContent = "metal:"; row.style.cssText = "height:30px;margin:20px 15px 20px 0;";
				var vect = document.createElement("div"); vect.style.cssText = "width:170px;height:40px;float:right;";
				var prev = document.createElement("li"); prev.innerHTML = "&#9668;"; prev.style.display = "inline";
				var next = document.createElement("li"); next.innerHTML = "&#9658;"; next.style.display = "inline";
				prev.id = "create-matcap-metalness-decrease"; prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");
				next.id = "create-matcap-metalness-increase"; next.classList.add("btn","btn-primary","get-next-btn","pull-right"); 

				var input = document.createElement("input"); input.id = "create-matcap-metalness-input";
				input.setAttribute("placeholder", "num" ); input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";
				vect.appendChild(prev); vect.appendChild(input); vect.appendChild(next); row.appendChild(vect); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		//	create-matcap-remove-button-ui.js

			(function( tab ){

			//	Create Matcap Remove button.
				var row = document.createElement("h3"); row.style.cssText = "height:30px;margin-bottom:20px;display:none;";
				var btn = document.createElement("div"); btn.id = "create-matcap-remove-button"; btn.textContent = "Remove Texture";
				btn.classList.add( "form-control","btn", "btn-primary","btn-white-outline","gradient-btn" );
				btn.style.cssText = "width:-webkit-fill-available;height:40px;font-size:large;margin-right:15px;float:right;";
				row.appendChild( btn ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );


		//	create-matcap-save-button-ui.js

			(function( tab ){

			//	Create Matcap Save button.
				var row = document.createElement("h3"); row.style.cssText = "height:30px;margin-bottom:20px;";
				var btn = document.createElement("div"); btn.id = "create-matcap-save-button"; btn.textContent = "Save Matcap";
				btn.classList.add( "form-control","btn", "btn-primary","btn-white-outline","gradient-btn" );
				btn.style.cssText = "width:-webkit-fill-available;height:40px;font-size:large;margin-right:15px;float:right;";
				row.appendChild( btn ); tab.appendChild( row );

			})( TabUI.NewMatcap.tab );

		</script>

		<script>

		//	create-matcap-viewer.js

			const matcapViewer = {

				canvas: TabUI.NewMatcap.tab.querySelector("canvas#create-matcap-viewer"),

			};

		//	Matcap Viewer scene.

			(function( viewer ){

				var interval;

			//	Viewer scene.

				viewer.scene = (function(){
					var scene = new THREE.Scene();
					scene.name = "material scene";
					return scene;
				})();

			//	Viewer camera.

				viewer.camera = (function( d ){
				//	var aspect = canvas.clientWidth / canvas.clientWidth;
					var camera = new THREE.OrthographicCamera( -d, +d, +d, -d, 1, 100 );
					camera.name = "camera"; camera.position.z = 10; camera.lookAt( 0,0,0 ); 
					viewer.scene.add( camera ); return camera;
				})( 1 );

			//	Viewer light.

				viewer.light = (function(){
					var light = new THREE.DirectionalLight( 0xffffff, 1 ); 
					light.name = "light"; light.position.set( 0,30,50 ); 
					viewer.scene.add( light ); return light;
				})();

			//  Viewr Renderer.

				viewer.renderer = new THREE.WebGLRenderer({
					alpha: true,  // for transparent rendering set alpha:true, important!
					canvas: viewer.canvas,
					antialias: true,
					preserveDrawingBuffer: true,
				});

				viewer.renderer.gammaInput = true;
				viewer.renderer.gammaOutput = true;
				viewer.renderer.shadowMap.enabled = true;
				viewer.renderer.setClearAlpha( 0 ); // for transparent rendering set clear alpha: 0.
				viewer.renderer.setClearColor( 0x000000, 0 ); // for transparent rendering set clear alpha: 0.
				viewer.renderer.setPixelRatio( window.devicePixelRatio );
				viewer.renderer.setSize( viewer.canvas.width, viewer.canvas.height );
				viewer.renderer.domElement.style.background = "none";  // transparent rendering. important!

			//	Viewer mesh.

				viewer.mesh = (function(){
					var mesh = new THREE.Mesh(
						new THREE.SphereGeometry(1,64,32), new THREE.MeshStandardMaterial()
					); mesh.material.bumpScale = 0; mesh.material.normalScale.set(1,1); 
					mesh.material.displacementBias = 0, mesh.material.displacementScale = 0;
					mesh.material.roughness = 0.5; mesh.material.metalness = 0.5; // important!
					mesh.material.name = "new matcap"; mesh.name = "matcap viewer mesh"; 
					viewer.scene.add( mesh ); return mesh;
				})();

			//	Viewer render.

				viewer.render = function(){ 
					viewer.mesh.material.needsUpdate = true; 
					viewer.renderer.render( viewer.scene, viewer.camera ); 
				};

			//	Viewer dispose.

				viewer.dispose = function(){

				//	dispose textures.

					(function( material ){
						material && material.map && material.map.dispose && material.map.dispose();
						material && material.bumpMap && material.bumpMap.dispose && material.bumpMap.dispose();
						material && material.alphaMap && material.alphaMap.dispose && material.alphaMap.dispose();
						material && material.normalMap && material.normalMap.dispose && material.normalMap.dispose();
						material && material.emissiveMap && material.emissiveMap.dispose && material.emissiveMap.dispose();
						material && material.roughnessMap && material.roughnessMap.dispose && material.roughnessMap.dispose();
						material && material.metalnessMap && material.metalnessMap.dispose && material.metalnessMap.dispose();
						material && material.displacementMap && material.displacementMap.dispose && material.displacementMap.dispose();
						material && material.lightMap && material.lightMap.dispose && material.lightMap.dispose();
						material && material.envMap && material.envMap.dispose && material.envMap.dispose();
						material && material.aoMap && material.aoMap.dispose && material.aoMap.dispose();
					})( viewer.mesh.material );

				//	remove textures.

					viewer.mesh.material.map = null;
					viewer.mesh.material.bumpMap = null;
					viewer.mesh.material.alphaMap = null;
					viewer.mesh.material.normalMap = null;
					viewer.mesh.material.emissiveMap = null;
					viewer.mesh.material.roughnessMap = null;
					viewer.mesh.material.metalnessMap = null;
					viewer.mesh.material.displacementMap = null;
					viewer.mesh.material.lightMap = null;
					viewer.mesh.material.envMap = null;
					viewer.mesh.material.aoMap = null;
				}

			//	Viewer Mesh Material render.
				watch( viewer.mesh, "material", function(prop, action, value){ 
					debugMode && console.log({item:prop,action:action,value:value}); // debug.
					clearTimeout( interval ); interval = setTimeout( viewer.render ); // important!
				}, 0);

			//	Viewer render.
				viewer.render(); // important!

			})( matcapViewer );

		</script>

		<script>

		//	create-matcap-buttons.js

			(function(viewer,button,input,map_droplist){

				var interval, k=0;

			//	Creates new material, and replaces matcap viewer material.
				watch( button, "onclick", function(prop, event, material){ map_droplist.value = "";
					viewer.dispose(); viewer.mesh.material = material; input.value = material.name;
					debugMode && console.log({item:button,event:event,material:material}); // debug.
				});

				button.addEventListener( "click", function(){
					clearTimeout(interval); interval = setTimeout(function(button){
						callWatchers(button, "onclick", "click", new THREE.MeshStandardMaterial({ 
							name:"untitled matcap " + (++k), bumpScale:0, 
							displacementBias:0, displacementScale:0,roughness:0.5, metalness:0.5, })
						);
					}, 250, this);
				})

			})( matcapViewer, 
				TabUI.NewMatcap.tab.querySelector("div#create-matcap-button"), // button,
				TabUI.NewMatcap.tab.querySelector("input#create-matcap-name-input"), // input,
				TabUI.NewMatcap.tab.querySelector("select#create-matcap-map-droplist") // map_droplist,
			);

		//	create-matcap-name-input.js

			(function(viewer,name_input){

				watch( name_input, "onchange", function(prop, event, value){ viewer.mesh.material.name = value; });
				name_input.addEventListener( "change", function(){ callWatchers( this, "onchange", "change", this.value ); });

			})( matcapViewer, TabUI.NewMatcap.tab.querySelector("input#create-matcap-name-input") ); // name_input,

		//	create-matcap-image-input.js

			(function(viewer,icon,image_button,image_input,map_droplist){

				watch( image_button, "onclick", function(prop, event, value){ image_input.value = ""; image_input.click(); });
				watch( map_droplist, "onchange", function(prop, event, value){ image_input.value = ""; image_input.click(); });

				image_input.addEventListener( "change", function(){

					if ( !map_droplist.value ) return;
					if ( !image_input.files.length ) return;

					var file = image_input.files[0];

					var img = new Image();
					img.addEventListener("load", function(){

						var key = map_droplist.value; if ( !key ) return;

					//	draw icon.
						icon.getContext( "2d" ).drawImage( img, 0, 0, icon.width, icon.height );

					//	create texture.
						var texture = new THREE.Texture(img); // or canvas.
						texture.name = file.name.replace(".jpg","").replace(".png","").replace(/_/g," ");
						texture.sourceFile = file.name; viewer.mesh.material[key] = texture; 
						viewer.mesh.material[key].needsUpdate = viewer.mesh.material.needsUpdate = true;

					//	render material. // important!
						callWatchers( viewer.mesh, "material", "render", viewer.mesh.material );
					});

					var reader = new FileReader();
					reader.addEventListener("load", function() {
						img.name = file.name; img.src = reader.result;
					});

					reader.readAsDataURL(file);
				});

				image_button.addEventListener( "click", function(){ callWatchers( image_button, "onclick", "click"); });

			})( matcapViewer, 
				TabUI.NewMatcap.tab.querySelector("canvas#create-matcap-icon"), // icon,
				TabUI.NewMatcap.tab.querySelector("div#create-matcap-img-button"), // image_button,
				TabUI.NewMatcap.tab.querySelector("input#create-matcap-file-input"), // image_input,
				TabUI.NewMatcap.tab.querySelector("select#create-matcap-map-droplist") // map_droplist,
			);






		</script>

		<script>

/*
			(function(){

				var material;
				var textures = {};
				var tab = TabUI.Material.tab;
				var Signal = signals.Signal;
				var textureClicked = new Signal();

				textures.dispose = function(){
					for (var uuid in this ) {
						var texture = this[ uuid ];
						texture.dispose && texture.dispose();
					}
				}

				textureClicked.add( function( uuid ){
					material.roughness = 0;
					material.metalness = 1;
					material.envMap = textures[ uuid ];
					material.envMap.needsUpdate = true;
					material.needsUpdate = true;
				});

				var matcaps = (
				//	"MZV8PzS,L509oY2,Bw7q38p,2FA0yx1,vVDGl7g,3nmnKd4,E36SPOB,MXqauTz,YHsPLdq,soRJv4a," // (large:2K)
					"bixnsMm,MS1GDja,pUytALG,4KwC8wH,Wiqsp9s,gXRFY3U,2tkhy7C,D64zaTR,Id8k2u4,Fx9154f,"
					+ "dqKYFPo,l0Lf1LN,7bH7Ajw,IeAwKEi,VysdwUU,dWAhf12,9ufYr2S,iAWd8i1,mkGDAn5,gf3PsvD,"
					+ "BeHwxKA,GYBQ8Xr,9gxylAS,0p2RT39,aHeUCko,epbmrGs,NKMFDGB,pvXMCj9,QbZ8H2v,aCAVXQb,"
					+ "qU0AEUM,yvwt1wj,D5UeFcC,6GZMeko,rSlm3oM,Xqg7n0A,PzHZLHy,MEzwCJq,wgf7Vl0,GcLQiey,"
					+ "3xH34nj,vhdhgMe,jRTIv3l,xELCxlQ,wtJaViy,Qb0qKtc,7kq8wQ3,F6kcile,0LRxFql,rxUXS8C,"
					+ "qXg0NKn,LSB7hqR,EolEkFt,gOtyiMy,YTE0R32,thsIYPF,ee6stBn,gyYhQao,QOEE3jO,0V4rQPV,"
					+ "l9Tugo0,R86xHzg,IDlk0H9,tUparH7,GISkhjO,JQzRceW,Jl6XqD0,4tyRlwP,aFIJ3Iu,BCqRnS4,"
					+ "1OcGlAa,PqIxyYE,S7J95Cf,QPUvzXD,Stdy1eT,k0nOt5N,rWuDYYe,SGRUmyD,1Ia4Qbk,FFYLtQa,"
					+ "szmc38X,NJSPJlS,8HsVNJA,n3wbE5E,88autaS,7jwTUiI,H1F3Yrv,kgV7aSY,PDFIrWw,Uun8Lpr,"
					+ "Oz16d2L,02gRNwL,bV94g46,eUEtBHC,e1N7JYN,bWpofvm,uzlo3mR,YaXveL2,mw2f1lF,HkWGQb1,"
					+ "N9xoehs,53rWmmo,sBPySdS,1YZKblR,ywKHb7r,3UcbBN7,pWPtSJS,n1a2nB8,lecZa2Q,e3bxY9I,"
					+ "WxVSuFW," // normal matcap.
				).split(",")

				matcaps.pop(); // removes last empty item. (important!)

				var container = document.createElement("div");
				container.id = "matcap-buttons";
				container.style.width = "300px";

				while ( matcaps.length ) {
					(function( id ){

						var button = document.createElement("div");
						button.id = id;
						button.classList.add("btn", "btn-white-outline", "btn-terrain");
						button.style.cssText = "background-size:contain;background-image:url(https://i.imgur.com/"+id+"s.png);";
					//
						var url = "https://i.imgur.com/"+id+".png";   // TODO: cache matcaps.
						var loader = new THREE.ImageLoader();
						loader.setCrossOrigin("anonymous");						// important!
						loader.load( url, function( image ){
							var mapping = THREE.SphericalReflectionMapping;		// important!
							var texture = new THREE.Texture( image, mapping );	// important!
							texture.sourceFile = url;							// important!
							textures[ texture.uuid ] = texture;
							button.setAttribute("uuid", texture.uuid);
							container.appendChild( button );
						});
					//
						button.addEventListener( "click", function(){
							var select = document.getElementById("material-droplist");
							var selected = scene.getObjectByProperty("uuid", select.value);
							if ( !selected ) return;
							var material = selected.material;
							if ( !material ) return;
							var uuid = button.getAttribute("uuid");
							material.roughness = 0;
							material.metalness = 1;
							material.envMap = textures[ uuid ];
							material.envMap.needsUpdate = true;
							material.needsUpdate = true;
							textures.dispose();
						//	textureClicked.dispatch( uuid );
						});

					})( matcaps.shift() );

				}

				tab.appendChild( container );

			})();
*/
		</script>

		<script>

			TabUI.NewMatcap.role.classList.add("active");
			TabUI.NewMatcap.tab.classList.add("in","active");
			TabUI.NewMatcap.pill.scrollIntoViewIfNeeded(false);

		//	scene.add(ground);
		//	mirror.visible = !mirror.visible; 
		//	ground.visible = !ground.visible; 
			groundHelper.visible = !groundHelper.visible; 


		//	Add entities.
		//	entities.add(scene);
		//	entities.add(mirror);
		//	entities.add(ground);
		//	entities.add(localPlayer);
			entities.add(groundHelper);
			entities.add(localPlayer.getObjectByName("local helper"));

			cameraControls.setLatLon(5.128, 270.675);
			localPlayer.controller.movementSpeed = 20;
			localPlayer.controller.center.set(-85,2,-2);
		//	localPlayer.visible = !localPlayer.visible; 

		</script>

		<script src="/editor/src/database-tab-ui.js"></script>
		<script src="/editor/src/database-inputs.js"></script>
	<!-- script src="/editor/src/ViewportTab.js"></script -->
		<script src="/editor/src/playground.js"></script>

	</body>
</html>
