<!DOCTYPE html>
<html lang="en">
	<head>

		<title>Editor (alpha 0.1.7.2)</title>

		<meta charset="utf-8">
		<meta name="generator" content="Three.js Editor">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<link rel="stylesheet" href="/css/joystick.css">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootbox-dialoges.css">
		<link rel="stylesheet" href="/css/jcrop.css">

		<script src="/js/watch.js"></script>
		<script src="/js/Objectid.js"></script>
		<script src="/js/jquery.min.js"></script> 
		<script src="/js/system.min.js"></script>
		<script src="/js/signals.min.js"></script>
		<script src="/js/inflate.min.js"></script>
		<script src="/js/zangodb.min.js"></script>
		<script src="/js/bootstrap.min.js"></script>
		<script src="/js/validator.min.js"></script>
		<script src="/js/hold-event.min.js"></script>
		<script src="/js/jcrop.js"></script>

		<style>

			body {
				margin: 0px;
				font-size: 13px;
				font-family: sans-serif;
				background-repeat: repeat;
				background-image: url("https://i.imgur.com/rnZZU0i.png") !important;
				overflow: hidden;
			}

			#loading-bar {
				width:100%;
				height:100%;
				top:0; left:0;
				position:fixed;
				display:flex;
				align-items:center;
				justify-content:center;
			}

			.middle > * {
				top:0; 
				left:0;
				right:0;
				bottom:0;
				margin:auto;
				position:absolute;
			}

			#joystick1 {
				right: calc(40px + 370px);
			}
			
			#jumpButton {
				right: calc(105px + 370px);
			}

			.btn-matcap,
			.btn-terrain {
				padding:0;
				float:left;
				width:55px;
				height:55px;
				border:1px solid;
				border-radius:4px;
				margin-right:4px;
				margin-bottom:4px;
				display:inline-block;
			}

			.btn-matcap + .btn-matcap,
			.btn-terrain + .btn-terrain {
				margin-right:4px;
			}

		</style>
	</head>

	<body ontouchstart="">

		<script src="/editor/js/TabUI.js"></script>

		<script>
			const debugMode = true;
			const Signal = signals.Signal;
			const RAD2DEG = 57.29577951308232;
			const DEG2RAD = 0.017453292519943295;
			document.body.appendChild( createSidePanel() );
		</script>

		<script src="/editor/js/three.js"></script>
		<script src="/editor/js/MeshWalk.js"></script>
		<script src="/editor/js/UVsDebug.js"></script>
		<script src="/editor/js/FBXLoader.js"></script>
		<script src="/editor/js/VirtualInput.js"></script>
		<script src="/editor/js/KeyboardState.js"></script>
		<script src="/editor/js/EditorControls.js"></script>
		<script src="/editor/js/camera-controls.js"></script>
		<script src="/editor/js/SubdivisionModifier.js"></script>
		<script src="/editor/js/three-pathfinding.umd.js"></script>

		<script src="/threejs/r96/examples/js/loaders/MTLLoader.js"></script>
		<script src="/threejs/r96/examples/js/loaders/OBJLoader.js"></script>
		<script src="/threejs/r96/examples/js/loaders/GLTFLoader.js"></script>

		<script src="/threejs/r96/examples/js/exporters/GLTFExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/STLExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/OBJExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/ColladaExporter.js"></script>

	<!-- Water.js -->

		<script src="/editor/js/Ocean_fft.js"></script>
		<script src="/editor/js/MirrorRenderer.js"></script>
		<script src="/editor/js/WaterMaterial.js"></script>

	<!-- Engine.js -->

		<script src="/editor/core/helpers.js"></script>
		<script src="/editor/core/keyboard.js"></script>
		<script src="/editor/core/enviroment.js"></script>
		<script src="/editor/core/localPlayer.js"></script>
		<script src="/editor/core/cameraControls.js"></script>
		<script src="/editor/core/keyboardState.js"></script>
		<script src="/editor/core/keyInputControls.js"></script>
		<script src="/editor/core/joystickControls.js"></script>

	<!-- Editor.js -->

		<script src="/editor/src/EntityManager.js"></script>
		<script src="/editor/src/MaterialManager.js"></script>
		<script src="/editor/src/TexturesManager.js"></script>
		<script src="/editor/src/UndoArray.js"></script>
		<script src="/editor/src/imgru-db.js"></script>
		<script src="/editor/src/editor-meta.js"></script>
		<script src="/editor/src/material-db.js"></script>

		<script src="/editor/src/editor-tab-ui.js"></script>
		<script src="/editor/src/geometry-tab-ui.js"></script>
		<script src="/editor/src/material-tab-ui.js"></script>
		<script src="/editor/src/material-editor-textures-tab-ui.js"></script>
		<script src="/editor/src/images-tab-ui.js"></script>
		<script src="/editor/src/material-library-tab-ui.js"></script>
		<script src="/editor/src/model3D-tab-ui.js"></script>
		<script src="/editor/src/skydome-tab-ui.js"></script>
		<script src="/editor/src/textures-tab-ui.js"></script>
		<script src="/editor/src/create-matcap-tab-ui.js"></script>
		<script src="/editor/src/create-new-material-tab-ui.js"></script>

		<script src="/editor/src/watchers-call-ui.js"></script>
		<script src="/editor/src/entities-helpers.js"></script>
		<script src="/editor/src/TextureEditor.js"></script>
		<script src="/editor/src/MaterialEditor.js"></script>
		<script src="/editor/src/Object3DEditor.js"></script>
		<script src="/editor/src/RigidObjects.js"></script>
		<script src="/editor/src/editor-droplists.js"></script>
		<script src="/editor/src/edges-helper.js"></script>
		<script src="/editor/src/octree-helpers.js"></script>
		<script src="/editor/src/geometry-buttons.js"></script>
		<script src="/editor/src/geometry-inputs.js"></script>
		<script src="/editor/src/editor-buttons.js"></script>
		<script src="/editor/src/rigid-objects-buttons.js"></script>
		<script src="/editor/src/editor-key-inputs.js"></script>
		<script src="/editor/src/editor-mouse-inputs.js"></script>
		<script src="/editor/src/editor-manager.js"></script>
		<script src="/editor/src/editor-systems.js"></script>
		<script src="/editor/src/material-droplists.js"></script>
		<script src="/editor/src/material-manager.js"></script>
		<script src="/editor/src/material-buttons.js"></script>
		<script src="/editor/src/material-key-inputs.js"></script>
		<script src="/editor/src/material-mouse-inputs.js"></script>
		<script src="/editor/src/texture-droplists.js"></script>
		<script src="/editor/src/texture-manager.js"></script>
		<script src="/editor/src/texture-buttons.js"></script>
		<script src="/editor/src/texture-key-inputs.js"></script>
		<script src="/editor/src/texture-mouse-inputs.js"></script>
		<script src="/editor/src/texture-viewer.js"></script>
		<script src="/editor/src/editor-center-helper.js"></script>
		<script src="/editor/src/Water.js"></script>
		<script src="/editor/src/Skydome.js"></script>
		<script src="/editor/src/skydome-droplist.js"></script>
		<script src="/editor/src/background-droplist.js"></script>
		<script src="/editor/src/skydome-buttons.js"></script>
		<script src="/editor/src/images-inputs.js"></script>
		<script src="/editor/src/images-uploads.js"></script>

		<script src="/editor/src/create-new-material-viewer.js"></script>
		<script src="/editor/src/create-new-material-buttons.js"></script>

		<script src="/editor/src/material-library-upload-button.js"></script>
		<script src="/editor/src/material-library-update-button.js"></script>
		<script src="/editor/src/material-library-inputs.js"></script>

		<script src="/editor/src/MaterialEditorViewer.js"></script>
		<script src="/editor/src/material-editor-textures-buttons.js"></script>
		<script src="/editor/src/material-editor-textures-key-inputs.js"></script>
		<script src="/editor/src/material-editor-textures-mouse-inputs.js"></script>
		<script src="/editor/src/material-editor-textures-droplists.js"></script>

		<script src="/editor/src/create-matcap-viewer.js"></script>
		<script src="/editor/src/create-matcap-buttons.js"></script>

		<script>
/*
		//	modeldB.js

			const modeldB = new zango.Db( "model", [
				"imgur","objects","geometries","materials","textures","images", // data collections.
				"models"  // entry collections.
			]);

			(function(db){
				db.open(function(err, database){ if (err) console.error(err);
				}).then( function(){ debugMode && console.log( 
					"Database", db.name, "(v"+db.version+")", "ready for use.");
				}).catch(function(err){ console.error(err); });
			})( modeldB );
*/
		</script>

		<script>
/*
		//	model3D-obj-upload-droplist.js

			(function(img_viewer,mtl_fileinput,obj_fileinput,img_fileinput,textures_fileinput,uploader_droplist){

				watch( uploader_droplist, "onchange", function(prop, event, value){ 

					switch ( value ) {
						case "":
						//	reset!
						//	img_fileinput.value = "";
						//	mtl_fileinput.value = "";
						//	obj_fileinput.value = "";
						//	textures_fileinput.value = "";
						break;
						case "img":
							img_fileinput.value = "";
							img_fileinput.click();
						break;
						case "mtl":
							mtl_fileinput.value = "";
							mtl_fileinput.click();
						break;
						case "obj":
							obj_fileinput.value = "";
							obj_fileinput.click();
						break;
						case "textures":
							textures_fileinput.value = "";
							textures_fileinput.click();
						break;
					}

				});

				uploader_droplist.addEventListener( "change", function(){ this.blur(); callWatchers(this, "onchange", "change", this.value )})

			})( 
				TabUI.Model3D.tab.querySelector("img#model-3d-image-viewer"),           // img_viewer,
				TabUI.Model3D.tab.querySelector("input#model-3d-mtl-file-input"),       // mtl_fileinput,
				TabUI.Model3D.tab.querySelector("input#model-3d-obj-file-input"),       // obj_fileinput,
				TabUI.Model3D.tab.querySelector("input#model-3d-preview-file-input"),   // image_fileinput,
				TabUI.Model3D.tab.querySelector("input#model-3d-textures-file-input"),  // textures_fileinput,
				TabUI.Model3D.tab.querySelector("select#model-3d-obj-upload-droplist"), // uploader_droplist,
			);
*/
		</script>

		<script>

		//	sweethome objects loader (demo)

			(function(next_doc,prev_doc,name_input,img_viewer,load_button,collection_droplist){

				var interval, index = 0, limit = 100, items = [];

				window.addEventListener( "mouseup", function (){ clearTimeout( interval ); }); // important!

				var names = {
					trees:"blackTupelo,fanPalm,lombardyPoplar,palm,quakingAspen,sassafras,weepingWillow",
				};

			//	Collection droplist.

				watch(collection_droplist, "onchange",function(prop, event, value){

					index = 0; items = names[value].split(","); // reset.

				//	Get names.

					if ( items.length > index ) {

						name_input.value = items[index]; img_viewer.src = "/"+"models"+"/"+value+"/"+items[index]+".png";

					} else {

						name_input.value = ""; img_viewer.src = ":0";
					}

				});

				watch( next_doc, "onclick", function( prop, event, value ){
				//	debugMode && console.log({item:next_doc,event:event,index:value});
				});

				watch( prev_doc, "onclick", function( prop, event, value ){
				//	debugMode && console.log({item:prev_doc,event:event,index:value});
				});

				watch( name_input, "onchange", function( prop, event, value ){ 
					debugMode && console.log({item:name_input,event:event,index:value});
				});
/*
			//	on mouse down.

				next_doc.addEventListener( "mousedown", function(){
					clearTimeout( interval ); // important!
					interval = setTimeout(function increase(){
						interval = setTimeout(increase, 100);
					}, 500);
				});

				prev_doc.addEventListener( "mousedown", function(){
					clearTimeout( interval ); // important!
					interval = setTimeout(function decrease(){
						interval = setTimeout(decrease, 100);
					}, 500);
				});
*/
			//	on mouse click.

				next_doc.addEventListener( "click", function(){
					clearTimeout( interval ); // important!

					if ( !items.length ) { name_input.value = ""; img_viewer.src = ":0"; return; }
					var max = items.length - 1; var i = index = THREE.Math.clamp(++index, 0, max);

					var folder = collection_droplist.value;
					var src = "/"+"models"+"/"+folder+"/"+items[i]+".png";
					name_input.value = items[i]; img_viewer.src = src; 

					callWatchers( this, "onclick", "click", index ); // important!
				});

				prev_doc.addEventListener( "click", function(){
					clearTimeout( interval ); // important!

					if ( !items.length ) { name_input.value = ""; img_viewer.src = ":0"; return; }
					var max = items.length - 1; var i = index = THREE.Math.clamp(--index, 0, max);

					var folder = collection_droplist.value;
					var src = "/"+"models"+"/"+folder+"/"+items[i]+".png";
					name_input.value = items[i]; img_viewer.src = src; 

					callWatchers( this, "onclick", "click", index ); // important!
				});

				collection_droplist.addEventListener( "change", function(){
					this.blur(); callWatchers( this, "onchange", "change", this.value );
				});

			//	Load button.

				watch( load_button, "onclick", function(prop, event, value){

					var baseUrl = "/"+"models"+"/"+collection_droplist.value+"/"+value+"/";
					var mtlfilename = value + ".mtl"; var objfilename = value + ".obj";

					var mtlLoader = new THREE.MTLLoader(); 
					mtlLoader.setCrossOrigin("anonymous"); mtlLoader.setPath( baseUrl ); 
					mtlLoader.load( mtlfilename, function onLoad( materials ) {

						materials.preload(); debugMode && console.log( materials ); 

					//	add material entities.
						for ( var name in materials.materials ) {
							material_entities.add( materials.materials[ name ] );
						}

						var objLoader = new THREE.OBJLoader();
						objLoader.setMaterials( materials ); objLoader.setPath( baseUrl ); 
						objLoader.load( objfilename, function ( group ) {

							group.name = value;
							group.position.set(0,0,0); 
							debugMode && console.log( group ); 
							scene.add( group ); entities.add( group );
						//	group.traverse(function(mesh){ entities.add(object); })

						}, function onProgress( xhr ) {

							if ( xhr.lengthComputable ) {
								var loaded = xhr.loaded; var total = xhr.total;
								var x = Math.ceil( ( loaded / total ) * 100 ); 
							//	debugMode && console.log( x+"%:", xhr.loaded );
							}

						}); // end obj loader.

					}); // end mtl loader.

				}); // end watch.

				load_button.addEventListener("click", function(){
					clearTimeout( interval );
					interval = setTimeout(function(button){
						callWatchers( button, "onclick", "click", items[index] );
					}, 250, this);
				});

				callWatchers(collection_droplist, "onchange", "change", collection_droplist.value);

			})( 
				TabUI.Model3D.tab.querySelector("li#model-3d-doc-next"), // next_doc,
				TabUI.Model3D.tab.querySelector("li#model-3d-doc-previous"), // prev_doc,
				TabUI.Model3D.tab.querySelector("input#model-3d-name-input"), // name_input,
				TabUI.Model3D.tab.querySelector("img#model-3d-image-viewer"), // img_viewer,
				TabUI.Model3D.tab.querySelector("div#model-3d-load-button"),  // load_button,
				TabUI.Model3D.tab.querySelector("select#model-3d-collection-droplist") // collection_droplist,
			);







		</script>

		<script>

			TabUI.Model3D.role.classList.add("active");
			TabUI.Model3D.tab.classList.add("in","active");
			TabUI.Model3D.pill.scrollIntoViewIfNeeded(false);

		//	scene.add(ground);
		//	mirror.visible = !mirror.visible; 
		//	ground.visible = !ground.visible; 
			groundHelper.visible = !groundHelper.visible; 


		//	Add entities.
		//	entities.add(scene);
		//	entities.add(mirror);
		//	entities.add(ground);
		//	entities.add(localPlayer);
			entities.add(groundHelper);
			entities.add(localPlayer.getObjectByName("local helper"));

			cameraControls.setLatLon(5.128, 270.675);
			localPlayer.controller.movementSpeed = 20;
			localPlayer.controller.center.set(-85,2,-2);
		//	localPlayer.visible = !localPlayer.visible; 

		</script>

		<script src="/editor/src/database-tab-ui.js"></script>
		<script src="/editor/src/database-inputs.js"></script>
	<!-- script src="/editor/src/ViewportTab.js"></script -->
		<script src="/editor/src/playground.js"></script>

	</body>
</html>
